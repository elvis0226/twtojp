<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>台幣 ↔ 日幣 臭皮用</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #ffeef8 0%, #ffe4f1 50%, #ffd6ea 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      max-width: 450px;
      width: 100%;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(214, 51, 132, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    h1 {
      text-align: center;
      color: #d63384;
      font-size: 2.2em;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(214, 51, 132, 0.1);
      background: linear-gradient(45deg, #d63384, #ff6b9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #a8336b;
      font-weight: bold;
      font-size: 1.1em;
    }
    
    input, select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #ffb3d1;
      border-radius: 15px;
      font-size: 1.1em;
      background: rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
      outline: none;
    }
    
    input:focus, select:focus {
      border-color: #d63384;
      box-shadow: 0 0 0 3px rgba(214, 51, 132, 0.2);
      transform: translateY(-2px);
    }
    
    .direction-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .direction-group select {
      flex: 1;
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 15px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #d63384, #ff6b9d);
      color: white;
      box-shadow: 0 4px 15px rgba(214, 51, 132, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(214, 51, 132, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(45deg, #ffb3d1, #ffc2dd);
      color: #a8336b;
      box-shadow: 0 4px 15px rgba(255, 179, 209, 0.3);
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 179, 209, 0.4);
    }
    
    .reverse-btn {
      background: linear-gradient(45deg, #ff8fab, #ffb3d1);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5em;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 143, 171, 0.3);
    }
    
    .reverse-btn:hover {
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 143, 171, 0.4);
    }
    
    .result {
      background: linear-gradient(45deg, #fff0f8, #ffe8f3);
      border: 2px solid #ffb3d1;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      font-size: 1.3em;
      font-weight: bold;
      color: #d63384;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(214, 51, 132, 0.1);
    }
    
    .divider {
      border: none;
      height: 2px;
      background: linear-gradient(90deg, transparent, #ffb3d1, transparent);
      margin: 30px 0;
    }
    
    .calculator {
      background: rgba(255, 240, 248, 0.8);
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .calc-display {
      background: white;
      border: 2px solid #ffb3d1;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      font-size: 1.1em;
      color: #a8336b;
      font-weight: bold;
      text-align: right;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }
    
    .calc-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    
    .calc-btn {
      padding: 15px;
      font-size: 1.2em;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: white;
      background: linear-gradient(45deg, #ff8fab, #ffb3d1);
    }
    
    .calc-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(255, 143, 171, 0.4);
    }
    
    .calc-btn.operator {
      background: linear-gradient(45deg, #d63384, #ff6b9d);
    }
    
    .calc-btn.equals {
      background: linear-gradient(45deg, #c9184a, #d63384);
      grid-column: span 2;
    }
    
    .calc-btn.clear {
      background: linear-gradient(45deg, #ff9999, #ffb3b3);
    }
    
    .rate-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .rate-group input {
      flex: 1;
    }
    
    @media (max-width: 480px) {
      .container {
        margin: 10px;
        padding: 20px;
      }
      
      h1 {
        font-size: 1.8em;
      }
      
      .calc-buttons {
        gap: 8px;
      }
      
      .calc-btn {
        padding: 12px;
        font-size: 1.1em;
      }
    }
    
    .loading {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>💖 台幣 ↔ 日幣 臭皮用</h1>
    
    <div class="input-group">
      <label>💰 金額</label>
      <input type="number" id="amount" placeholder="請輸入金額" oninput="convert()" />
    </div>
    
    <div class="input-group">
      <label>🔄 轉換方向</label>
      <div class="direction-group">
        <select id="direction" onchange="convert()">
          <option value="twdToJpy">台幣 → 日幣</option>
          <option value="jpyToTwd">日幣 → 台幣</option>
        </select>
        <button class="reverse-btn" onclick="reverseDirection()" title="切換轉換方向">🔄</button>
      </div>
    </div>
    
    <div class="input-group">
      <label>📈 匯率 (1 台幣 = ? 日幣)</label>
      <div class="rate-group">
        <input type="number" id="rate" value="4.5" step="0.0001" oninput="convert()" />
        <button class="btn btn-secondary" onclick="fetchRate()">🔄 更新</button>
      </div>
    </div>
    
    <button class="btn btn-primary" style="width: 100%; margin-bottom: 20px;" onclick="toggleFullscreen()">📱 全螢幕模式</button>
    
    <div class="result" id="result">請輸入金額進行轉換</div>
    
    <hr class="divider" />
    
    <div class="calculator">
      <h3 style="text-align: center; color: #d63384; margin-bottom: 20px;">✨ 可愛計算機 ✨</h3>
      
      <div class="calc-display" id="calcFormula">算式：0</div>
      <div class="calc-display" id="calcDisplay">結果：0</div>
      
      <div class="calc-buttons">
        <button class="calc-btn clear" onclick="clearCalc()">C</button>
        <button class="calc-btn operator" onclick="appendCalc('/')" title="除法">÷</button>
        <button class="calc-btn operator" onclick="appendCalc('*')" title="乘法">×</button>
        <button class="calc-btn operator" onclick="deleteLastCalc()" title="刪除">⌫</button>
        
        <button class="calc-btn" onclick="appendCalc('7')">7</button>
        <button class="calc-btn" onclick="appendCalc('8')">8</button>
        <button class="calc-btn" onclick="appendCalc('9')">9</button>
        <button class="calc-btn operator" onclick="appendCalc('-')" title="減法">-</button>
        
        <button class="calc-btn" onclick="appendCalc('4')">4</button>
        <button class="calc-btn" onclick="appendCalc('5')">5</button>
        <button class="calc-btn" onclick="appendCalc('6')">6</button>
        <button class="calc-btn operator" onclick="appendCalc('+')" title="加法">+</button>
        
        <button class="calc-btn" onclick="appendCalc('1')">1</button>
        <button class="calc-btn" onclick="appendCalc('2')">2</button>
        <button class="calc-btn" onclick="appendCalc('3')">3</button>
        <button class="calc-btn equals" onclick="calculate()" title="計算結果">=</button>
        
        <button class="calc-btn" onclick="appendCalc('0')" style="grid-column: span 2;">0</button>
        <button class="calc-btn" onclick="appendCalc('.')">.</button>
      </div>
    </div>
  </div>

  <script>
    let calcInput = "";
    
    async function fetchRate() {
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = "載入中...";
      btn.classList.add("loading");
      btn.disabled = true;
      
      try {
        const res = await fetch("https://twd-jpy-rate.elvis0226.workers.dev");
        const data = await res.json();
        const rate = data.rate;
        document.getElementById("rate").value = rate.toFixed(4);
        convert();
        
        // 顯示成功訊息
        btn.textContent = "✅ 已更新";
        setTimeout(() => {
          btn.textContent = originalText;
        }, 1500);
      } catch (e) {
        console.error("匯率更新失敗:", e);
        btn.textContent = "❌ 失敗";
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
        alert("無法取得即時匯率，請稍後再試或手動輸入匯率");
      } finally {
        btn.classList.remove("loading");
        btn.disabled = false;
      }
    }

    function convert() {
      const amount = parseFloat(document.getElementById('amount').value);
      const direction = document.getElementById('direction').value;
      const rate = parseFloat(document.getElementById('rate').value);
      let resultText = '';

      if (isNaN(amount) || amount === 0) {
        resultText = '請輸入金額進行轉換';
      } else if (isNaN(rate) || rate <= 0) {
        resultText = '請輸入正確的匯率';
      } else {
        if (direction === 'twdToJpy') {
          const result = (amount * rate).toFixed(2);
          resultText = `💰 ${amount.toLocaleString()} 台幣 ≈ ${parseFloat(result).toLocaleString()} 日幣`;
        } else {
          const result = (amount / rate).toFixed(2);
          resultText = `🌸 ${amount.toLocaleString()} 日幣 ≈ ${parseFloat(result).toLocaleString()} 台幣`;
        }
      }

      document.getElementById('result').textContent = resultText;
    }

    function reverseDirection() {
      const direction = document.getElementById('direction');
      direction.value = direction.value === 'twdToJpy' ? 'jpyToTwd' : 'twdToJpy';
      convert();
    }

    function toggleFullscreen() {
      const el = document.documentElement;
      if (!document.fullscreenElement) {
        el.requestFullscreen().catch(err => {
          console.error(`無法進入全螢幕: ${err.message}`);
          alert(`無法進入全螢幕模式，您的瀏覽器可能不支援此功能`);
        });
      } else {
        document.exitFullscreen();
      }
    }

    function appendCalc(val) {
      // 防止連續輸入運算符
      if (['+', '-', '*', '/'].includes(val)) {
        if (calcInput === "" || /[+\-*/]$/.test(calcInput)) {
          return;
        }
      }
      
      calcInput += val;
      updateCalcDisplay();
    }

    function deleteLastCalc() {
      calcInput = calcInput.slice(0, -1);
      updateCalcDisplay();
    }

    function clearCalc() {
      calcInput = "";
      updateCalcDisplay();
    }

    function updateCalcDisplay() {
      const formula = calcInput || "0";
      document.getElementById('calcFormula').textContent = `算式：${formula}`;
      
      // 即時顯示計算結果
      if (calcInput && !/[+\-*/]$/.test(calcInput)) {
        try {
          const result = eval(calcInput);
          document.getElementById('calcDisplay').textContent = `結果：${result}`;
        } catch {
          document.getElementById('calcDisplay').textContent = `結果：${calcInput}`;
        }
      } else {
        document.getElementById('calcDisplay').textContent = `結果：${calcInput || "0"}`;
      }
    }

    function calculate() {
      if (!calcInput) return;
      
      try {
        const result = eval(calcInput);
        document.getElementById('calcFormula').textContent = `算式：${calcInput}`;
        document.getElementById('calcDisplay').textContent = `結果：${result}`;
        
        // 將結果填入金額欄位
        document.getElementById('amount').value = result;
        convert();
        
        // 清空計算機輸入
        calcInput = "";
      } catch (error) {
        document.getElementById('calcDisplay').textContent = "結果：計算錯誤";
        console.error("計算錯誤:", error);
      }
    }

    // 鍵盤支援
    document.addEventListener('keydown', function(e) {
      if (e.target.tagName === 'INPUT') return;
      
      if (/[0-9]/.test(e.key)) {
        appendCalc(e.key);
      } else if (['+', '-', '*', '/'].includes(e.key)) {
        appendCalc(e.key);
      } else if (e.key === '.') {
        appendCalc('.');
      } else if (e.key === 'Enter' || e.key === '=') {
        calculate();
      } else if (e.key === 'Escape' || e.key === 'c' || e.key === 'C') {
        clearCalc();
      } else if (e.key === 'Backspace') {
        deleteLastCalc();
      }
    });

    // 頁面載入時自動獲取匯率
    window.addEventListener('load', function() {
      fetchRate();
    });
  </script>
</body>
</html>